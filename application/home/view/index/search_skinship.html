{include file="public/header_popup"}

<div class="container-fluid">
	<div class="row">
		<div class="col-sm-12">
				<form name="form2" action="" method="post">
				<table class="table">
	                    <tbody>
	                        <tr>
	                            <td class="span2">有关系人：</td>
	                            <td>
	                               <input type="text" name="name" class="essentialtexr" value="" />
	                               <input type="button" class="btn btn-primary" value="查询" onclick="checkForm();" />
	                            </td>
	                        </tr>
	                    </tbody>
	                </table>
				</form>
		</div>		
	</div>			
</div>

{include file="public/footer"}
<style>
tbody tr.searchCategory {
	cursor: pointer;
}
tbody tr.searchCategory:hover {
	background-color: #eee;
}
</style>

<script src="__MYLIBRARY__/js/jquery.form.min.js"></script>
<script src="__MYLIBRARY__/layer/layer.js"></script>
<script src="__MYLIBRARY__/jscolor/jscolor.min.js"></script>
<script>
function checkForm(){
	var name = $("input[name='name']").val();
	
	if(name == ''){
		layer.msg('请输入关系人名称');
		$("input[name='name']").focus();
		return false;
	}

	$.ajax({
		url: "searchSkinship",
		type: "post",
		data: $("form").serialize(),
		dataType: "json",
		success: function(res){
			if(res.status == 200){
				
				for(i in res.data){
					$("tbody").append("<tr class='searchCategory'><td></td><td onclick='selectItem(" + res.data[i]['id'] + ", \"" + res.data[i]['str'] + "\""  + ")'>" + res.data[i]['str'] + "</td></tr>");
				}
			}else{
				alert(res.msg);
			}
		}
	});
}


function selectItem(id, str){
	parent.$("#skinship_id").val(id);
	parent.$("#skinship").val(str);
	var index = parent.layer.getFrameIndex(window.name); //获取窗口索引
	parent.layer.close(index);  // 关闭layer
}
</script>